<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Карта курьера</title>
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
  <style>
    html, body, #map { width: 100%; height: 100%; margin: 0; padding: 0; }
  </style>
</head>
<body>
  <div id="map"></div>
  <script>
    let map, courierPlacemark;

    function initMap(lat = 55.75, lng = 37.61) {
      map = new ymaps.Map("map", {
        center: [lat, lng],
        zoom: 12
      });

      courierPlacemark = new ymaps.Placemark(
        [lat, lng],
        { balloonContent: 'Курьер сейчас здесь' }
      );

      map.geoObjects.add(courierPlacemark);
    }

    function updateCourierPosition(lat, lng) {
      courierPlacemark.geometry.setCoordinates([lat, lng]);
    }

    async function fetchCourierLocation() {
      try {
        const response = await fetch("https://your-project.supabase.co/rest/v1/courier_locations?select=lat,lng&courier_id=eq.123", {
          headers: {
            "apikey": "ВАШ_API_КЛЮЧ",
            "Authorization": "Bearer ВАШ_API_КЛЮЧ"
          }
        });
        const data = await response.json();
        if (data.length > 0) {
          updateCourierPosition(data[0].lat, data[0].lng);
        }
      } catch (e) {
        console.error("Ошибка загрузки координат:", e);
      }
    }

    ymaps.ready(() => {
      initMap();  // Инициализация карты
      fetchCourierLocation();  // Загрузка позиции курьера
      setInterval(fetchCourierLocation, 10000);  // Обновление каждые 10 секунд
    });
  </script>
</body>
</html>
